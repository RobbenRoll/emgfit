<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>emgfit.hypothesis_tests &mdash; emgfit 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=3fadbb4a"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            emgfit
          </a>
              <div class="version">
                0.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Getting started with emgfit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emgfit_tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Central concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">emgfit API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">emgfit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">emgfit.hypothesis_tests</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for emgfit.hypothesis_tests</h1><div class="highlight"><pre>
<span></span><span class="c1">################################################################################</span>
<span class="c1">##### Python module for performing hypothesis tests on TOF mass spectra</span>
<span class="c1">##### Author: Stefan Paul</span>

<span class="c1">##### Import packages</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">emgfit.sample</span> <span class="kn">import</span> <span class="n">simulate_spectrum</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="c1">################################################################################</span>
<div class="viewcode-block" id="_likelihood_ratio_test"><a class="viewcode-back" href="../../modules.html#emgfit.hypothesis_tests._likelihood_ratio_test">[docs]</a><span class="k">def</span> <span class="nf">_likelihood_ratio_test</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">ref_result</span><span class="p">,</span> <span class="n">alt_x_pos</span><span class="p">,</span> <span class="n">x_fit_cen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">x_fit_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vary_alt_mu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">alt_mu_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alt_mu_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">vary_baseline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">par_hint_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_results</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a local likelihood ratio test on the specified spectrum</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spec : :class:`emgfit.spectrum.spectrum`</span>
<span class="sd">        Spectrum object to perform likelihood ratio test on.</span>
<span class="sd">    ref_result : :class:`emgfit.model.EMGModelResult`</span>
<span class="sd">        Fit result storing the null model.</span>
<span class="sd">    alt_x_pos : float [u]</span>
<span class="sd">        Position of the hypothesized alternative peak.</span>
<span class="sd">    x_fit_cen : float [u], optional</span>
<span class="sd">        Center of the x-range to fit. Defaults to the center of the fit result</span>
<span class="sd">        asociated with `null_result_index`.</span>
<span class="sd">    x_fit_range : float [u], optional</span>
<span class="sd">        Width of the x-range to fit.  Defaults to the range of the fit result</span>
<span class="sd">        asociated with `null_result_index`.</span>
<span class="sd">    vary_alt_mu : bool, optional</span>
<span class="sd">        Whether to vary the alternative-peak centroid in the fit.</span>
<span class="sd">    alt_mu_min : float [u], optional</span>
<span class="sd">        Lower boundary to use when varying the alternative-peak centroid.</span>
<span class="sd">        Defaults to the range defined by the `MU_VAR_NSIGMA` constant in the</span>
<span class="sd">        :mod:`emgfit.fit_models` module.</span>
<span class="sd">    alt_mu_max : float [u], optional</span>
<span class="sd">        Upper boundary to use when varying the alternative-peak centroid.</span>
<span class="sd">        Defaults to the range defined by the `MU_VAR_NSIGMA` constant in the</span>
<span class="sd">        :mod:`emgfit.fit_models` module.</span>
<span class="sd">    vary_baseline : bool, optional</span>
<span class="sd">        If `True`, the constant background will be fitted with a varying</span>
<span class="sd">        uniform baseline parameter `bkg_c`. If `False`, the baseline parameter</span>
<span class="sd">        `bkg_c` will be fixed to 0.</span>
<span class="sd">    par_hint_args : dict of dicts, optional</span>
<span class="sd">        Arguments to pass to :meth:`lmfit.model.Model.set_param_hint` to</span>
<span class="sd">        modify or add model parameters. See docs of</span>
<span class="sd">        :meth:`~emgfit.spectrum.spectrum.peakfit` method for details.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Whether to print status updates and results.</span>
<span class="sd">    show_plots : bool, optional</span>
<span class="sd">        Whether to show plots of the fit results.</span>
<span class="sd">    show_results : bool, optional</span>
<span class="sd">        Whether to display reports with the fit results.</span>

<span class="sd">    Returns </span>
<span class="sd">    -------</span>
<span class="sd">    tuple of format (float, :class:`~emgfit.model.EMGModelResult`, :class:`~emgfit.model.EMGModelResult`)</span>
<span class="sd">        Tuple storing the Log-likelihood ratio of null and alternative model, </span>
<span class="sd">        the null fit result and the alternative model result.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fit_model</span> <span class="o">=</span> <span class="n">ref_result</span><span class="o">.</span><span class="n">fit_model</span>
    <span class="k">if</span> <span class="n">x_fit_cen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_fit_cen</span> <span class="o">=</span> <span class="n">ref_result</span><span class="o">.</span><span class="n">x_fit_cen</span>
    <span class="k">if</span> <span class="n">x_fit_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_fit_range</span> <span class="o">=</span> <span class="n">ref_result</span><span class="o">.</span><span class="n">x_fit_range</span>
    <span class="k">if</span> <span class="n">par_hint_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">par_hint_args</span> <span class="o">=</span> <span class="n">ref_result</span><span class="o">.</span><span class="n">par_hint_args</span>
    <span class="k">if</span> <span class="n">ref_result</span><span class="o">.</span><span class="n">cost_func</span> <span class="o">!=</span> <span class="s2">&quot;MLE&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This method is only applicable to fits with the &quot;</span>
                        <span class="s2">&quot;&#39;MLE&#39; cost function.&quot;</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Fit data with null model #&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">null_result</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">peakfit</span><span class="p">(</span><span class="n">x_fit_cen</span><span class="o">=</span><span class="n">x_fit_cen</span><span class="p">,</span>
                                   <span class="n">x_fit_range</span><span class="o">=</span><span class="n">x_fit_range</span><span class="p">,</span>
                                   <span class="n">fit_model</span><span class="o">=</span><span class="n">fit_model</span><span class="p">,</span>
                                   <span class="n">cost_func</span><span class="o">=</span><span class="s1">&#39;MLE&#39;</span><span class="p">,</span>
                                   <span class="n">vary_baseline</span><span class="o">=</span><span class="n">vary_baseline</span><span class="p">,</span>
                                   <span class="n">par_hint_args</span><span class="o">=</span><span class="n">par_hint_args</span><span class="p">,</span>
                                   <span class="n">show_plots</span><span class="o">=</span><span class="n">show_plots</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_results</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">null_result</span><span class="p">)</span>
        <span class="n">null_LLR</span> <span class="o">=</span> <span class="n">null_result</span><span class="o">.</span><span class="n">chisqr</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Fit with null model failed failed with ValueError.&quot;</span><span class="p">)</span>
        <span class="n">null_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">null_LLR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">alt_spec</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Fit data with alternative model #&quot;</span><span class="p">)</span>
    <span class="n">alt_spec</span><span class="o">.</span><span class="n">add_peak</span><span class="p">(</span><span class="n">x_pos</span><span class="o">=</span><span class="n">alt_x_pos</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># Update initial parameters of alternative peak</span>
    <span class="n">alt_peak</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">alt_spec</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">x_pos</span><span class="o">==</span><span class="n">alt_x_pos</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pref_alt_peak</span> <span class="o">=</span> <span class="s2">&quot;p</span><span class="si">{}</span><span class="s2">_&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alt_spec</span><span class="o">.</span><span class="n">peaks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">alt_peak</span><span class="p">))</span>
    <span class="n">alt_mu_hints</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">vary_alt_mu</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">alt_mu_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alt_mu_hints</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;min&quot;</span> <span class="p">:</span> <span class="n">alt_mu_min</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">alt_mu_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alt_mu_hints</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;max&quot;</span> <span class="p">:</span> <span class="n">alt_mu_max</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alt_mu_hints</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;vary&quot;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">alt_par_hint_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">par_hint_args</span><span class="p">)</span>
    <span class="n">alt_par_hint_args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pref_alt_peak</span><span class="o">+</span><span class="s2">&quot;mu&quot;</span> <span class="p">:</span> <span class="n">alt_mu_hints</span><span class="p">})</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">alt_result</span> <span class="o">=</span> <span class="n">alt_spec</span><span class="o">.</span><span class="n">peakfit</span><span class="p">(</span><span class="n">x_fit_cen</span><span class="o">=</span><span class="n">null_result</span><span class="o">.</span><span class="n">x_fit_cen</span><span class="p">,</span>
                                      <span class="n">x_fit_range</span><span class="o">=</span><span class="n">null_result</span><span class="o">.</span><span class="n">x_fit_range</span><span class="p">,</span>
                                      <span class="n">fit_model</span><span class="o">=</span><span class="n">fit_model</span><span class="p">,</span>
                                      <span class="n">cost_func</span><span class="o">=</span><span class="s1">&#39;MLE&#39;</span><span class="p">,</span>
                                      <span class="n">vary_baseline</span><span class="o">=</span><span class="n">vary_baseline</span><span class="p">,</span>
                                      <span class="n">show_plots</span><span class="o">=</span><span class="n">show_plots</span><span class="p">,</span>
                                      <span class="n">par_hint_args</span><span class="o">=</span><span class="n">alt_par_hint_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_results</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">alt_result</span><span class="p">)</span>
        <span class="n">alt_LLR</span> <span class="o">=</span> <span class="n">alt_result</span><span class="o">.</span><span class="n">chisqr</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Fit with alternative model failed with ValueError.&quot;</span><span class="p">)</span>
        <span class="n">alt_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">alt_LLR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Calculate likelihood ratio test statistic</span>
    <span class="n">LLR</span> <span class="o">=</span> <span class="n">null_LLR</span> <span class="o">-</span> <span class="n">alt_LLR</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Log-likelihood ratio test statistic:  LLR = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LLR</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">LLR</span><span class="p">,</span> <span class="n">null_result</span><span class="p">,</span> <span class="n">alt_result</span></div>


<div class="viewcode-block" id="run_MC_likelihood_ratio_test"><a class="viewcode-back" href="../../modules.html#emgfit.hypothesis_tests.run_MC_likelihood_ratio_test">[docs]</a><span class="k">def</span> <span class="nf">run_MC_likelihood_ratio_test</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">null_result_index</span><span class="p">,</span> <span class="n">alt_x_pos</span><span class="p">,</span>
                                 <span class="n">alt_mu_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alt_mu_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">min_significance</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">N_spectra</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                 <span class="n">vary_ref_mus_and_amps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">vary_ref_peak_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                 <span class="n">show_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_LLR_hist</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform Monte Carlo likelihood ratio test by fitting simulated spectra</span>

<span class="sd">    The simulated spectra are sampled from the null model stored in the</span>
<span class="sd">    spectrum&#39;s fit results list and asociated with the peak index</span>
<span class="sd">    `null_result_index`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spec : :class:`~emgfit.spectrum.spectrum`</span>
<span class="sd">        Spectrum object to perform likelihood ratio test on.</span>
<span class="sd">    null_result_index : int</span>
<span class="sd">        Index (of one) of the peak(s) present in the null-model fit.</span>
<span class="sd">    alt_x_pos : float, optional</span>
<span class="sd">        Initial position to use for alternative peak</span>
<span class="sd">    alt_mu_min : float [u], optional</span>
<span class="sd">        Lower boundary to use when varying the alternative-peak centroid.</span>
<span class="sd">        Defaults to the range defined by the `MU_VAR_NSIGMA` constant in the</span>
<span class="sd">        :mod:`emgfit.fit_models` module.</span>
<span class="sd">    alt_mu_max : float [u], optional</span>
<span class="sd">        Upper boundary to use when varying the alternative-peak centroid.</span>
<span class="sd">        Defaults to the range defined by the `MU_VAR_NSIGMA` constant in the</span>
<span class="sd">        :mod:`emgfit.fit_models` module.</span>
<span class="sd">    vary_ref_mus_and_amps : bool, optional</span>
<span class="sd">        Whether to randomly vary the peak positions and the peak and background</span>
<span class="sd">        amplitudes of the reference spectrum within their parameter </span>
<span class="sd">        uncertainties.</span>
<span class="sd">    vary_ref_peak_shape : bool, optional</span>
<span class="sd">        Whether to vary the reference peak shape used for the event sampling in</span>
<span class="sd">        the creation of simulated spectra. If `True`, `N_spectra` parameter</span>
<span class="sd">        samples are drawn randomly with replacement from the </span>
<span class="sd">        :attr:`~emgfit.spectrum.spectrum.MCMC_par_samples` obtained in the MCMC </span>
<span class="sd">        shape parameter sampling.</span>
<span class="sd">    min_significance : float, optional, default: 3</span>
<span class="sd">        Critical significance level for rejecting the null hypothesis (measured</span>
<span class="sd">        in sigma).</span>
<span class="sd">    N_spectra : int, optional, default: 10000</span>
<span class="sd">        Number of simulated spectra to sample from the null model.</span>
<span class="sd">    seed : int, optional</span>
<span class="sd">        Random seed to use for reproducible sampling.</span>
<span class="sd">    n_cores : int, optional, default: -1</span>
<span class="sd">        Number of CPU cores to use for parallelized sampling and fitting of</span>
<span class="sd">        simulated spectra. If ``-1``, all available cores are used.</span>
<span class="sd">    show_plots : bool, optional</span>
<span class="sd">        Whether to show plots of the fit results.</span>
<span class="sd">    show_results : bool, optional</span>
<span class="sd">        Whether to display reports with the fit results.</span>
<span class="sd">    show_LLR_hist : bool, optional </span>
<span class="sd">        Whether to display histogram of log-likelihood ratio values collected</span>
<span class="sd">        for p-value determination.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary with results of the likelihood ratio test.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    :func:`run_GV_likelihood_ratio_test`</span>
<span class="sd">    :func:`_likelihood_ratio_test`</span>

<span class="sd">    Notes </span>
<span class="sd">    -----</span>
<span class="sd">    Simulated spectra are created by randomly sampling events from the null </span>
<span class="sd">    model best fitting the observed data. These simulated spectra are then </span>
<span class="sd">    fitted with both the null and the alternative model and the respective </span>
<span class="sd">    values for the likelihood ratio test statistic :math:`\Lambda` are </span>
<span class="sd">    calculated using the relation </span>

<span class="sd">    .. math::</span>

<span class="sd">      \\Lambda = \\log\\left(\\frac{\\mathcal{L}(H_1)}{\\mathcal{L}(H_0)}\\right) = L(H_1) - L(H_0),</span>

<span class="sd">    where :math:`L(H_0)` and :math:`L(H_1)` denote the MLE cost function values </span>
<span class="sd">    (i.e. the negative doubled log-likelihood values) obtained from the </span>
<span class="sd">    null-model and alternative-model fits, respectively, and </span>
<span class="sd">    :math:`\mathcal{L}(H_0)` and :math:`\mathcal{L}(H_1)` mark the </span>
<span class="sd">    corresponding likelihood functions. Finally, the p-value is calculated as </span>

<span class="sd">    .. math:: </span>

<span class="sd">      p = \\frac{N_&gt;}{N_&lt; + N_&gt;}, </span>

<span class="sd">    where :math:`N_&lt;` and :math:`N_&gt;` denote the number of likelihood ratio </span>
<span class="sd">    values :math:`\Lambda` that fall below and above the observed value for the </span>
<span class="sd">    likelihood ratio test statistic :math:`\Lambda_\mathrm{obs}`, respectively. </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">min_significance</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># sf := 1 - cdf</span>
    <span class="n">ref_null_result</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">fit_results</span><span class="p">[</span><span class="n">null_result_index</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">vary_ref_peak_shape</span><span class="p">:</span>
        <span class="n">MC_shape_par_samples</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">MCMC_par_samples</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">N_spectra</span><span class="p">,</span>
                                                            <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">MC_shape_par_samples</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">##### Performing Monte Carlo likelihood ratio test #####&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N_spectra:&quot;</span><span class="p">,</span><span class="n">N_spectra</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test at </span><span class="si">{</span><span class="n">min_significance</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> sigma significance level, i.e. alpha = </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Perform LRT on the observed data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### Determine test statistic for observed data ###&quot;</span><span class="p">)</span>
    <span class="n">LLR</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alt_res</span> <span class="o">=</span> <span class="n">_likelihood_ratio_test</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">ref_null_result</span><span class="p">,</span>
                                             <span class="n">alt_x_pos</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">show_results</span><span class="o">=</span><span class="n">show_results</span><span class="p">,</span>
                                             <span class="n">show_plots</span><span class="o">=</span><span class="n">show_plots</span><span class="p">,</span>
                                             <span class="n">alt_mu_min</span><span class="o">=</span><span class="n">alt_mu_min</span><span class="p">,</span>
                                             <span class="n">alt_mu_max</span><span class="o">=</span><span class="n">alt_mu_max</span><span class="p">,</span>
                                             <span class="n">vary_alt_mu</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Run LRTs on spectra sampled from best null-model fit of the observed data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### Determine test statistic for simulated Monte Carlo spectra ###&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">emgfit.sample</span> <span class="kn">import</span> <span class="n">fit_simulated_spectra</span>
    <span class="n">null_results</span> <span class="o">=</span> <span class="n">fit_simulated_spectra</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">ref_null_result</span><span class="p">,</span>
                                        <span class="n">N_spectra</span><span class="o">=</span><span class="n">N_spectra</span><span class="p">,</span>
                                        <span class="n">randomize_ref_mus_and_amps</span><span class="o">=</span><span class="n">vary_ref_mus_and_amps</span><span class="p">,</span>
                                        <span class="n">MC_shape_par_samples</span><span class="o">=</span><span class="n">MC_shape_par_samples</span><span class="p">,</span>
                                        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=</span><span class="n">n_cores</span><span class="p">)</span>
    <span class="n">alt_results</span> <span class="o">=</span> <span class="n">fit_simulated_spectra</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">ref_null_result</span><span class="p">,</span>
                                        <span class="n">alt_result</span><span class="o">=</span><span class="n">alt_res</span><span class="p">,</span> <span class="n">N_spectra</span><span class="o">=</span><span class="n">N_spectra</span><span class="p">,</span>
                                        <span class="n">randomize_ref_mus_and_amps</span><span class="o">=</span><span class="n">vary_ref_mus_and_amps</span><span class="p">,</span>
                                        <span class="n">MC_shape_par_samples</span><span class="o">=</span><span class="n">MC_shape_par_samples</span><span class="p">,</span>
                                        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=</span><span class="n">n_cores</span><span class="p">)</span>

    <span class="c1"># Calculate Monte Carlo LRT statistics</span>
    <span class="n">MC_LLRs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">null</span><span class="p">,</span> <span class="n">alt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">null_results</span><span class="p">,</span> <span class="n">alt_results</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">null</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">alt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">MC_LLRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">null</span><span class="o">.</span><span class="n">success</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">alt</span><span class="o">.</span><span class="n">success</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">MC_LLRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MC_LLRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">null</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">-</span> <span class="n">alt</span><span class="o">.</span><span class="n">chisqr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_LLR_hist</span><span class="p">:</span>
        <span class="c1">#plt.figure(figsize=(8,12))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">MC_LLRs</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">LLR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Likelihood ratio test statistic&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Occurences&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Determine p-value from the fraction of LLR samples above the obs. LLR</span>
    <span class="n">N_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MC_LLRs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">LLR</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">N_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MC_LLRs</span><span class="p">)))</span>
    <span class="n">p_val</span> <span class="o">=</span> <span class="n">N_above</span><span class="o">/</span><span class="n">N_tot</span>
    <span class="k">if</span> <span class="n">N_above</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p_val_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_val</span><span class="o">/</span><span class="n">N_tot</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">N_above</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p_val_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N_tot</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monte Carlo p-value: p = </span><span class="si">{</span><span class="n">p_val</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">p_val_err</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p_val_err</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="n">success</span><span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Compare to defined alpha</span>
        <span class="k">if</span> <span class="n">p_val</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p &lt; alpha = </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> =&gt; Reject null model in favor of &quot;</span>
                   <span class="s2">&quot;alternative model with additional peak!&quot;</span><span class="p">)</span>
            <span class="n">reject_null_model</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p &gt; alpha = </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> =&gt; Reject alternative model in favor &quot;</span>
                   <span class="s2">&quot;of null model with fewer peaks!&quot;</span><span class="p">)</span>
            <span class="n">reject_null_model</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;MC error of the p-value &gt;= alpha. &quot;</span>
                      <span class="s2">&quot;Re-run with larger `N_spectra`!&quot;</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">reject_null_model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">LRT_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span> <span class="p">:</span> <span class="n">success</span><span class="p">,</span>
                   <span class="s2">&quot;LLR&quot;</span> <span class="p">:</span> <span class="n">LLR</span><span class="p">,</span>
                   <span class="s2">&quot;MC LLRs&quot;</span> <span class="p">:</span> <span class="n">MC_LLRs</span><span class="p">,</span>
                   <span class="s2">&quot;p-value&quot;</span> <span class="p">:</span> <span class="n">p_val</span><span class="p">,</span>
                   <span class="s2">&quot;p-value error&quot;</span> <span class="p">:</span> <span class="n">p_val_err</span><span class="p">,</span>
                   <span class="s2">&quot;reject_null_model&quot;</span> <span class="p">:</span> <span class="n">reject_null_model</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">LRT_results</span></div>


<div class="viewcode-block" id="run_GV_likelihood_ratio_test"><a class="viewcode-back" href="../../modules.html#emgfit.hypothesis_tests.run_GV_likelihood_ratio_test">[docs]</a><span class="k">def</span> <span class="nf">run_GV_likelihood_ratio_test</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">null_result_index</span><span class="p">,</span> <span class="n">alt_x_min</span><span class="p">,</span> <span class="n">alt_x_max</span><span class="p">,</span>
                                 <span class="n">alt_x_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_significance</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="n">N_spectra</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c0</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">show_upcrossings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_fits</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a likelihood ratio test following the method of Gross &amp; Vitells</span>

<span class="sd">    **Decide on an appropriate significance level before executing this method</span>
<span class="sd">    and set the `min_significance` argument accordingly!**</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spec : :class:`~emgfit.spectrum.spectrum`</span>
<span class="sd">        Spectrum object to perform test on.</span>
<span class="sd">    null_result_index : int</span>
<span class="sd">        Index (of one) of the peak(s) present in the null-model fit.</span>
<span class="sd">    alt_x_min : float</span>
<span class="sd">        Minimal x-position to use in the alternative-peak position scan.</span>
<span class="sd">    alt_x_max : float</span>
<span class="sd">        Maximal x-position to use in the alternative-peak position scan.</span>
<span class="sd">    alt_x_steps : int, optional, default: 100</span>
<span class="sd">        Number of steps to take in the alternative-peak position scan.</span>
<span class="sd">    min_significance : float [sigma], default: 3</span>
<span class="sd">        Minimal significance level (in sigma) required to reject the null model</span>
<span class="sd">        in favour of the alternative model.</span>
<span class="sd">    N_spectra : int, optional, default: 100</span>
<span class="sd">        Number of simulated spectra to fit at each x-position.</span>
<span class="sd">    c0 : float, optional, default: 0.5</span>
<span class="sd">        Threshold to use in determining the expected number of upcrossings.</span>
<span class="sd">    seed : int, optional</span>
<span class="sd">        Random seed to use for reproducible event sampling.</span>
<span class="sd">    show_upcrossings : bool, optional, default: True</span>
<span class="sd">        Whether to show plots of the range of upcrossings.</span>
<span class="sd">    show_fits : bool, optional, default: True</span>
<span class="sd">        Whether to show plots of the null- and alternative-model fits to the</span>
<span class="sd">        observed data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary with results of the likelihood ratio test.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    :func:`run_MC_likelihood_ratio_test`</span>
<span class="sd">    :func:`_likelihood_ratio_test`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    When the exact location of a hypothesized alternative peak is unknown, one</span>
<span class="sd">    may test for its presence by performing multiple hypothesis tests with</span>
<span class="sd">    different fixed alternative-peak positions. However, performing multiple</span>
<span class="sd">    tests on the same dataset artificially increases the rate of false discovery</span>
<span class="sd">    due to the increased chance for random background fluctuations to mimick a</span>
<span class="sd">    signal. In the high-energy particle physics literature, this complication </span>
<span class="sd">    is referred to as the look-elsewhere effect. To obtain a global p-value </span>
<span class="sd">    that correctly quantifies the likelihood to observe the alternative peak </span>
<span class="sd">    anywhere in the tested region, a procedure is needed that accounts for </span>
<span class="sd">    correlations between the local p-values obtained for the various tested </span>
<span class="sd">    peak positions. To this end, this function adapts the method outlined by </span>
<span class="sd">    Gross and Vitells in [#Gross]_. Namely, an upper limit on the global </span>
<span class="sd">    p-value :math:`p` is deduced from the relation:</span>

<span class="sd">    .. math::</span>

<span class="sd">       p = P(LLR &gt; c) \\leq P(\\chi^2_1 &gt; c)/2 + \\langle N(c_0)\\rangle e^{-\\left(c-c_0\\right)/2},</span>

<span class="sd">    where :math:`P(LLR &gt; c)` is the probability for the log-likelihood ratio </span>
<span class="sd">    statistic (LLR) to exceed the maximum of the observed local LLR statistic</span>
<span class="sd">    :math:`c`, :math:`P(\chi^2_1 &gt; c)` is the probability that the :math:`\chi^2`</span>
<span class="sd">    statistic with one degree of freedom exceeds the level :math:`c` and</span>
<span class="sd">    :math:`\\langle N(c_0)\\rangle` is the expected number of times the local </span>
<span class="sd">    LLR test statistics surpass the threshold level :math:`c_0 \ll c` under the </span>
<span class="sd">    null hypothesis. This number is estimated by simulating :math:`N_{spectra}`</span>
<span class="sd">    spectra from the null model and taken as the mean number of times the local</span>
<span class="sd">    LRT statistics cross up through the specified threshold level :math:`c_0`.</span>
<span class="sd">    In principle, :math:`c_0` should be chosen as small as possible but care</span>
<span class="sd">    should be taken that the mean spacing between detected upcrossings does</span>
<span class="sd">    not fall below the typical width of the observed peaks.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [#Gross] Gross, Eilam, and Vitells, Ofer. &quot;Trial factors for the look</span>
<span class="sd">       elsewhere effect in high energy physics.&quot; The European Physical Journal</span>
<span class="sd">       C 70 (2010): 525-530.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">min_significance</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># sf := 1 - cdf</span>
    <span class="n">alt_x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alt_x_min</span><span class="p">,</span> <span class="n">alt_x_max</span><span class="p">,</span> <span class="n">alt_x_steps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">scan_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alt_x_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">alt_x_pos</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">avg_bin_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ref_null_result</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">fit_results</span><span class="p">[</span><span class="n">null_result_index</span><span class="p">]</span>
    <span class="c1"># Check for approriately fine scan resolution:</span>
    <span class="k">if</span> <span class="n">scan_res</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">avg_bin_width</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The resolution of the peak-position scan is coarser &quot;</span>
                      <span class="s2">&quot;than the average bin width of the spectrum. Consider &quot;</span>
                      <span class="s2">&quot;raising the `alt_x_steps` argument.&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">##### Performing GV likelihood ratio test (LRT) #####&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N_spectra: </span><span class="si">{</span><span class="n">N_spectra</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Range of peak position scan: [</span><span class="si">{</span><span class="n">alt_x_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alt_x_max</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resolution of peak position scan: </span><span class="si">{</span><span class="n">scan_res</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test at </span><span class="si">{</span><span class="n">min_significance</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> sigma significance level&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;alpha = </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">obs_LLRs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">null_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alt_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">li_n_upcross</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Determine LRT statistic for all alternative peak positions from obs. data</span>
    <span class="k">for</span> <span class="n">x_alt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">alt_x_pos</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">obs_LLR</span><span class="p">,</span> <span class="n">null_res</span><span class="p">,</span> <span class="n">alt_res</span> <span class="o">=</span> <span class="n">_likelihood_ratio_test</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span>
                                                                <span class="n">ref_null_result</span><span class="p">,</span>
                                                                <span class="n">x_alt</span><span class="p">,</span>
                                                                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">vary_alt_mu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">show_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                <span class="n">show_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">obs_LLRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs_LLR</span><span class="p">)</span>
        <span class="n">null_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">null_res</span><span class="p">)</span>
        <span class="n">alt_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alt_res</span><span class="p">)</span>

    <span class="n">max_LLR</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">obs_LLRs</span><span class="p">)</span>
    <span class="n">idx_max_LLR</span> <span class="o">=</span> <span class="n">obs_LLRs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_LLR</span><span class="p">)</span>
    <span class="n">x_max_LLR</span> <span class="o">=</span> <span class="n">alt_x_pos</span><span class="p">[</span><span class="n">idx_max_LLR</span><span class="p">]</span>
    <span class="c1"># Plot null and alternative model fits yielding maximal LRT statistic</span>
    <span class="k">if</span> <span class="n">show_fits</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Fit results yielding the maximal LRT statistic with the observed data ###&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Null-model fit # &quot;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">(</span><span class="n">fit_result</span><span class="o">=</span><span class="n">null_results</span><span class="p">[</span><span class="n">idx_max_LLR</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Alternative-model fit # &quot;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">(</span><span class="n">fit_result</span><span class="o">=</span><span class="n">alt_results</span><span class="p">[</span><span class="n">idx_max_LLR</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">show_upcrossings</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;LRT statistics for observed data&quot;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alt_x_pos</span><span class="p">,</span> <span class="n">obs_LLRs</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x_max_LLR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="c1">#ax.ticklabel_format(useOffset=False, style=&#39;plain&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Alternative-peak centroid [u]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Local LRT statistic&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max. LRT statistic determined from exp. data: </span><span class="si">{</span><span class="n">max_LLR</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">x_max_LLR</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> u </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Determine mean number of upcrossings from simulated spectra ###&quot;</span><span class="p">)</span>
    <span class="n">all_sim_LLRs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N_spectra</span><span class="p">)):</span>
        <span class="n">sim_LLRs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Simulate spectrum from best-fit null model</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">sim_spec</span> <span class="o">=</span> <span class="n">simulate_spectrum</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">copy_spec</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x_alt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">alt_x_pos</span><span class="p">):</span>
            <span class="c1"># Fit data with null and alternative model to determine local LRT</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
                <span class="n">LLR_i</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_likelihood_ratio_test</span><span class="p">(</span><span class="n">sim_spec</span><span class="p">,</span>
                                                     <span class="n">ref_null_result</span><span class="p">,</span>
                                                     <span class="n">x_alt</span><span class="p">,</span>
                                                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">vary_alt_mu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">show_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">show_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sim_LLRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LLR_i</span><span class="p">)</span>

        <span class="c1"># Detect upcrossings</span>
        <span class="n">i_upcross</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">alt_x_steps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim_LLRs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">c0</span> <span class="ow">and</span> <span class="n">sim_LLRs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">c0</span><span class="p">]</span>
        <span class="n">n_upcross</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_upcross</span><span class="p">)</span>
        <span class="n">li_n_upcross</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_upcross</span><span class="p">)</span>
        <span class="n">all_sim_LLRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim_LLRs</span><span class="p">)</span>

        <span class="c1"># Plot local LRTs over alternative-peak position</span>
        <span class="k">if</span> <span class="n">show_upcrossings</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LRT statistics for simulated spectrum #</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alt_x_pos</span><span class="p">,</span> <span class="n">sim_LLRs</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">i_upcross</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">alt_x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
            <span class="c1">#ax.ticklabel_format(useOffset=False, style=&#39;plain&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Alternative-peak centroid [u]&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Local LRT statistic&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Calculate global p-value</span>
    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span>
    <span class="n">mean_n_upcross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">li_n_upcross</span><span class="p">)</span>
    <span class="n">std_n_upcross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">li_n_upcross</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">err_mean_n_upcross</span> <span class="o">=</span> <span class="n">std_n_upcross</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">li_n_upcross</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean number of upcrossings: </span><span class="si">{</span><span class="n">mean_n_upcross</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">err_mean_n_upcross</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># difference in number of free parameters in null &amp; alt. model</span>
    <span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">max_LLR</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">mean_n_upcross</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">max_LLR</span><span class="o">-</span><span class="n">c0</span><span class="p">))</span>
    <span class="n">p_val_err</span> <span class="o">=</span> <span class="n">err_mean_n_upcross</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">max_LLR</span><span class="o">-</span><span class="n">c0</span><span class="p">))</span>
    <span class="n">signif</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="n">p_val</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global p-value: p = </span><span class="si">{</span><span class="n">p_val</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">p_val_err</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">signif</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sigma significance) </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Compare to defined alpha</span>
    <span class="k">if</span> <span class="n">p_val</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p &lt; alpha = </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> =&gt; Reject null model in favor of &quot;</span>
               <span class="s2">&quot;alternative model with additional peak!&quot;</span><span class="p">)</span>
        <span class="n">reject_null_model</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">p_val</span> <span class="o">+</span> <span class="n">min_significance</span><span class="o">*</span><span class="n">p_val_err</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The p-value exceeds alpha within its &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_significance</span><span class="si">}</span><span class="s2">-sigma confidence interval. &quot;</span>
                          <span class="s2">&quot;Considering re-running with larger `N_spectra`.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p &gt; alpha = </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> =&gt; Reject alternative model in favor &quot;</span>
               <span class="s2">&quot;of null model with fewer peaks!&quot;</span><span class="p">)</span>
        <span class="n">reject_null_model</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">show_upcrossings</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_sim_LLRs</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">max_LLR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Local LRT statistic&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Occurences&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">LRT_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;LLR&quot;</span> <span class="p">:</span> <span class="n">max_LLR</span><span class="p">,</span>
                   <span class="s2">&quot;MC LLRs&quot;</span> <span class="p">:</span> <span class="n">all_sim_LLRs</span><span class="p">,</span>
                   <span class="s2">&quot;Mean number of upcrossings&quot;</span> <span class="p">:</span> <span class="n">mean_n_upcross</span><span class="p">,</span>
                   <span class="s2">&quot;Error mean number of upcrossings&quot;</span> <span class="p">:</span> <span class="n">std_n_upcross</span><span class="p">,</span>
                   <span class="s2">&quot;p-value&quot;</span> <span class="p">:</span> <span class="n">p_val</span><span class="p">,</span>
                   <span class="s2">&quot;p-value error&quot;</span> <span class="p">:</span> <span class="n">p_val_err</span><span class="p">,</span>
                   <span class="s2">&quot;reject_null_model&quot;</span> <span class="p">:</span> <span class="n">reject_null_model</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">LRT_results</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Stefan Paul.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>